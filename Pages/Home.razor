@page "/"
@using GitPagePortfolio.Models
@using GitPagePortfolio.Services
@inject ISnackbar Snackbar
@inject IJSRuntime JSRuntime
@inject NavigationManager NavManager
@inject PortfolioService PortfolioService

<style>
    /* 1. 애니메이션 정의 */
    @@keyframes floating-wobble {
        0% {
            transform: scale(1.05) rotate(-3deg) translateX(-5px);
        }

        50% {
            transform: scale(1.05) rotate(3deg) translateX(5px);
        }

        100% {
            transform: scale(1.05) rotate(-3deg) translateX(-5px);
        }
    }

    .github-button {
        transition: all 0.3s ease-in-out;
    }

        .github-button:hover {
            box-shadow: 0 0 50px rgba(57, 255, 20, 0.5);
            background-color: rgba(57, 255, 20, 0.25);
            animation: floating-wobble 3s ease-in-out infinite alternate;
        }
</style>

<PageTitle>ReltyWorks - Home</PageTitle>

<MudStack AlignItems="AlignItems.Center" Justify="Justify.Center" Spacing="2" Class="my-16">
    <MudText Typo="Typo.h2" Color="Color.Primary" Style="font-weight:bold; text-shadow: 0 0 20px #39ff14;">
        ReltyWorks
    </MudText>
    <MudText Typo="Typo.h5" Color="Color.Primary" Class="mb-4">
        UNITY & C# DEVELOPER
    </MudText>
    <MudText Typo="Typo.body1" Align="Align.Center">
        안녕하세요!<br />
        저는 Unity와 C# 개발자입니다.<br />
        게임 개발과 프로그래밍에 열정을 가지고 있으며,<br />
        끊임없이 배우고 성장하는 개발자가 되고자 합니다.
    </MudText>
</MudStack>

<MudDivider Class="my-12" />

<MudText Typo="Typo.h4" Color="Color.Primary" Align="Align.Center" Class="mb-8" Style="text-shadow: 0 0 10px #39ff14;">
    [ KEY PORTFOLIO ]
</MudText>

@if (keyPortfolio != null)
{
    <MudContainer MaxWidth="MaxWidth.Large">
        <MudText Typo="Typo.h5" Color="Color.Primary" Align="Align.Center" Class="mb-4" Style="font-weight:bold;">
            @keyPortfolio.Title
        </MudText>

        <MudText Typo="Typo.body1" Align="Align.Center" Class="mb-8" Style="color: white; white-space: pre-line;">
            @keyPortfolio.Description
        </MudText>

        <MudPaper Outlined="true" Class="pa-4 mb-8" Style="border: 2px solid #39ff14; background-color: rgba(57, 255, 20, 0.05);">
            <MudStack Spacing="4">
                @for (int i = 1; i <= keyPortfolio.TotalSlides; i++)
                {
                    int pageNum = i;
                    // 아까 합의한 경로: files/00/01.jpg
                    string imgPath = $"files/{keyPortfolio.Id:D2}/{pageNum:D2}.jpg";

                    <MudImage Src="@imgPath"
                              Fluid="true"
                              ObjectFit="ObjectFit.Contain"
                              Class="rounded-lg"
                              Style="width: 100%; display: block;"
                              Alt="@($"{keyPortfolio.Title} - Page {pageNum}")"
                              UserAttributes="@(new Dictionary<string, object> { { "loading", "lazy" } })" />
                }
            </MudStack>
        </MudPaper>

        <div class="d-flex justify-center my-4">
            <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Large" Href="/portfolios">
                &gt; 다른 프로젝트 보기
            </MudButton>
        </div>
    </MudContainer>
}
else
{
    <MudAlert Severity="Severity.Warning" Variant="Variant.Outlined" Class="my-4">
        표시할 Key Portfolio 데이터(ID: 0)가 없습니다. PortfolioService를 확인해주세요.
    </MudAlert>
}

<MudDivider Class="my-12" />

<MudGrid Class="mb-16">
    <MudItem xs="12" md="6">
        <MudText Typo="Typo.h4" Color="Color.Primary" Align="Align.Center" Class="mb-4">[ GITHUB ]</MudText>
        <MudPaper Class="d-flex flex-column align-center justify-center py-8 github-button"
                  Outlined="true"
                  Style="border-color:#39ff14; cursor:pointer;"
                  @onclick="@(() => NavigateToGithub())">
            <MudIcon Icon="@Icons.Custom.Brands.GitHub" Size="Size.Large" Color="Color.Primary" Style="font-size: 5rem;" />
            <MudText Typo="Typo.h6" Color="Color.Primary" Class="mt-4">VISIT MY GITHUB</MudText>
        </MudPaper>
    </MudItem>

    <MudItem xs="12" md="6">
        <MudText Typo="Typo.h4" Color="Color.Primary" Align="Align.Center" Class="mb-4">[ CONTACT ]</MudText>
        <MudList T="string" Clickable="true">
            <MudListItem Icon="@Icons.Material.Filled.Email" IconColor="Color.Primary" OnClick="@(() => CopyToClipboard("relty.works@gmail.com"))">
                relty.works@gmail.com
            </MudListItem>
            <MudListItem Icon="@Icons.Custom.Brands.Discord" IconColor="Color.Primary" OnClick="@(() => CopyToClipboard("https://discord.gg/zUjWwqYuz2"))">
                Discord Community
            </MudListItem>
            <MudListItem Icon="@Icons.Material.Filled.LocationOn" IconColor="Color.Primary">
                Seoul, Republic of Korea
            </MudListItem>
        </MudList>
    </MudItem>
</MudGrid>

@code {
    private Portfolio? keyPortfolio;

    protected override void OnInitialized()
    {
        // 0번 포트폴리오를 'Key Portfolio'로 가져옴
        keyPortfolio = PortfolioService.GetById(0);
    }

    private async Task CopyToClipboard(string text)
    {
        await JSRuntime.InvokeVoidAsync("navigator.clipboard.writeText", text);
        Snackbar.Configuration.PositionClass = Defaults.Classes.Position.BottomCenter;
        Snackbar.Configuration.ShowCloseIcon = false;
        Snackbar.Add($"CopyToClipboard", Severity.Success, config =>
        {
            config.HideTransitionDuration = 200;
            config.ShowTransitionDuration = 200;
            config.VisibleStateDuration = 750;
        });
    }

    void NavigateToGithub()
    {
        NavManager.NavigateTo("https://github.com/ReltyWorks", true);
    }
}